{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/thadzy/Documents/Thadzy/FIBO-Store/frontend/src/app/admin/page.tsx"],"sourcesContent":["\"use client\";\nimport { useState, useEffect } from \"react\";\nimport Navbar from \"@/components/Navbar\";\nimport { useSession } from \"next-auth/react\"; \nimport { useRouter } from \"next/navigation\";   \n\ninterface AdminBooking {\n  booking_id: number;\n  user_name: string;\n  status: string;\n  pickup_date: string;\n  return_date: string;\n  purpose: string;\n  items: { name: string; quantity: number }[];\n}\n\nexport default function AdminDashboard() {\n  const { data: session, status } = useSession(); \n  const router = useRouter();\n  \n  const [bookings, setBookings] = useState<AdminBooking[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  // --- Security Check ---\nuseEffect(() => {\n    // 1. ถ้ายืนยันตัวตนเสร็จแล้ว (ไม่ใช่สถานะ loading)\n    if (status !== \"loading\") {\n      \n      // 2. เช็คเงื่อนไข: \"ยังไม่ Login\" หรือ \"Login แล้วแต่ไม่ใช่ Admin\"\n      if (status === \"unauthenticated\" || session?.user?.role !== \"admin\") {\n        \n        // 3. แจ้งเตือนก่อน\n        alert(\"⛔️ Access Denied: คุณไม่มีสิทธิ์เข้าถึงหน้านี้!\");\n        \n        // 4. เตะกลับหน้าแรก\n        router.push(\"/\");\n      }\n    }\n  }, [status, session, router]);\n\n  // --- Fetch Data ---\n  const fetchBookings = async () => {\n    try {\n      const res = await fetch(\"http://127.0.0.1:8000/admin/bookings\");\n      if (!res.ok) throw new Error(\"Failed to fetch\");\n      const data = await res.json();\n      setBookings(data);\n    } catch (error) {\n      console.error(error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    if (status === \"authenticated\" && session?.user?.role === \"admin\") {\n      fetchBookings();\n    }\n  }, [status, session]);\n\n  // --- Update Status Function ---\n  const handleStatusUpdate = async (id: number, newStatus: string) => {\n    if (!confirm(`ยืนยันการเปลี่ยนสถานะเป็น \"${newStatus}\" ?`)) return;\n\n    try {\n      const res = await fetch(`http://127.0.0.1:8000/bookings/${id}/status`, {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ status: newStatus }),\n      });\n\n      if (!res.ok) throw new Error(\"Update failed\");\n\n      setBookings((prev) =>\n        prev.map((b) =>\n          b.booking_id === id ? { ...b, status: newStatus } : b\n        )\n      );\n      \n    } catch (error) {\n      alert(\"เกิดข้อผิดพลาดในการอัปเดต\");\n    }\n  };\n\n  // Helper เลือกสีป้ายสถานะ\n  const getStatusBadge = (status: string) => {\n    const styles: Record<string, string> = {\n      Pending: \"bg-yellow-100 text-yellow-800 border-yellow-200\",\n      Approved: \"bg-blue-100 text-blue-800 border-blue-200\",\n      Rejected: \"bg-red-100 text-red-800 border-red-200\",\n      Returned: \"bg-green-100 text-green-800 border-green-200\",\n    };\n    return (\n      <span className={`px-2 py-1 rounded-full text-xs font-bold border ${styles[status] || \"bg-gray-100\"}`}>\n        {status}\n      </span>\n    );\n  };\n\n  if (status === \"loading\" || session?.user?.role !== \"admin\") {\n    return <div className=\"min-h-screen flex items-center justify-center text-slate-400\">Verifying access...</div>;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-slate-100\">\n      <nav className=\"bg-white border-b border-slate-200 px-6 py-4 flex justify-between items-center shadow-sm\">\n        <h1 className=\"text-xl font-black text-slate-800 flex items-center gap-2\">\n          FIBO ADMIN <span className=\"text-xs bg-slate-800 text-white px-2 py-0.5 rounded\">Console</span>\n        </h1>\n        <button \n            onClick={fetchBookings} \n            className=\"text-sm text-blue-600 hover:underline font-bold\"\n        >\n            Refresh Data\n        </button>\n      </nav>\n\n      <main className=\"max-w-7xl mx-auto p-6\">\n        <h2 className=\"text-2xl font-bold text-slate-800 mb-6\">จัดการคำขอเบิกอุปกรณ์</h2>\n\n        {loading ? (\n          <p className=\"text-center mt-10\">Loading dashboard...</p>\n        ) : (\n          <div className=\"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden\">\n            <div className=\"overflow-x-auto\">\n              <table className=\"w-full text-sm text-left\">\n                <thead className=\"bg-slate-50 text-slate-500 font-bold border-b border-slate-200\">\n                  <tr>\n                    <th className=\"px-6 py-4\">ID</th>\n                    <th className=\"px-6 py-4\">User</th>\n                    <th className=\"px-6 py-4\">Items</th>\n                    <th className=\"px-6 py-4\">Dates</th>\n                    <th className=\"px-6 py-4\">Status</th>\n                    <th className=\"px-6 py-4 text-center\">Actions</th>\n                  </tr>\n                </thead>\n                <tbody className=\"divide-y divide-slate-100\">\n                  {bookings.map((booking) => (\n                    <tr key={booking.booking_id} className=\"hover:bg-slate-50 transition-colors\">\n                      <td className=\"px-6 py-4 font-mono text-slate-400\">#{booking.booking_id}</td>\n                      <td className=\"px-6 py-4\">\n                        <p className=\"font-bold text-slate-700\">{booking.user_name}</p>\n                        <p className=\"text-xs text-slate-400 truncate w-48\" title={booking.purpose}>\n                           {booking.purpose}\n                        </p>\n                      </td>\n                      <td className=\"px-6 py-4\">\n                        <ul className=\"space-y-1\">\n                          {booking.items.map((item, idx) => (\n                            <li key={idx} className=\"text-slate-600\">\n                              • {item.name} <span className=\"font-bold\">x{item.quantity}</span>\n                            </li>\n                          ))}\n                        </ul>\n                      </td>\n                      <td className=\"px-6 py-4 text-xs text-slate-500\">\n                        <div className=\"flex flex-col gap-1\">\n                            <span>รับ: {booking.pickup_date}</span>\n                            <span className=\"text-red-400\">คืน: {booking.return_date}</span>\n                        </div>\n                      </td>\n                      <td className=\"px-6 py-4\">\n                        {getStatusBadge(booking.status)}\n                      </td>\n                      <td className=\"px-6 py-4\">\n                        <div className=\"flex justify-center gap-2\">\n                          {booking.status === \"Pending\" && (\n                            <>\n                              <button\n                                onClick={() => handleStatusUpdate(booking.booking_id, \"Approved\")}\n                                className=\"bg-green-500 hover:bg-green-600 text-white px-3 py-1.5 rounded-lg text-xs font-bold shadow-sm transition-all active:scale-95\"\n                              >\n                                อนุมัติ\n                              </button>\n                              <button\n                                onClick={() => handleStatusUpdate(booking.booking_id, \"Rejected\")}\n                                className=\"bg-red-50 hover:bg-red-100 text-red-600 border border-red-200 px-3 py-1.5 rounded-lg text-xs font-bold transition-all active:scale-95\"\n                              >\n                                ปฏิเสธ\n                              </button>\n                            </>\n                          )}\n\n                          {booking.status === \"Approved\" && (\n                            <button\n                              onClick={() => handleStatusUpdate(booking.booking_id, \"Returned\")}\n                              className=\"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1.5 rounded-lg text-xs font-bold shadow-sm transition-all active:scale-95\"\n                            >\n                               คืนของแล้ว\n                            </button>\n                          )}\n\n                          {(booking.status === \"Rejected\" || booking.status === \"Returned\") && (\n                            <span className=\"text-slate-300 text-xs\">- closed -</span>\n                          )}\n                        </div>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        )}\n      </main>\n    </div>\n  );\n}"],"names":[],"mappings":";;;;;AACA;AAEA;AACA;;;AAJA;;;;AAgBe,SAAS;;IACtB,MAAM,EAAE,MAAM,OAAO,EAAE,MAAM,EAAE,GAAG,IAAA,+JAAU;IAC5C,MAAM,SAAS,IAAA,kJAAS;IAExB,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAiB,EAAE;IAC3D,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IAEvC,yBAAyB;IAC3B,IAAA,0KAAS;oCAAC;YACN,mDAAmD;YACnD,IAAI,WAAW,WAAW;gBAExB,mEAAmE;gBACnE,IAAI,WAAW,qBAAqB,SAAS,MAAM,SAAS,SAAS;oBAEnE,mBAAmB;oBACnB,MAAM;oBAEN,oBAAoB;oBACpB,OAAO,IAAI,CAAC;gBACd;YACF;QACF;mCAAG;QAAC;QAAQ;QAAS;KAAO;IAE5B,qBAAqB;IACrB,MAAM,gBAAgB;QACpB,IAAI;YACF,MAAM,MAAM,MAAM,MAAM;YACxB,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM;YAC7B,MAAM,OAAO,MAAM,IAAI,IAAI;YAC3B,YAAY;QACd,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC;QAChB,SAAU;YACR,WAAW;QACb;IACF;IAEA,IAAA,0KAAS;oCAAC;YACR,IAAI,WAAW,mBAAmB,SAAS,MAAM,SAAS,SAAS;gBACjE;YACF;QACF;mCAAG;QAAC;QAAQ;KAAQ;IAEpB,iCAAiC;IACjC,MAAM,qBAAqB,OAAO,IAAY;QAC5C,IAAI,CAAC,QAAQ,CAAC,2BAA2B,EAAE,UAAU,GAAG,CAAC,GAAG;QAE5D,IAAI;YACF,MAAM,MAAM,MAAM,MAAM,CAAC,+BAA+B,EAAE,GAAG,OAAO,CAAC,EAAE;gBACrE,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBAAE,QAAQ;gBAAU;YAC3C;YAEA,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM;YAE7B,YAAY,CAAC,OACX,KAAK,GAAG,CAAC,CAAC,IACR,EAAE,UAAU,KAAK,KAAK;wBAAE,GAAG,CAAC;wBAAE,QAAQ;oBAAU,IAAI;QAI1D,EAAE,OAAO,OAAO;YACd,MAAM;QACR;IACF;IAEA,0BAA0B;IAC1B,MAAM,iBAAiB,CAAC;QACtB,MAAM,SAAiC;YACrC,SAAS;YACT,UAAU;YACV,UAAU;YACV,UAAU;QACZ;QACA,qBACE,6LAAC;YAAK,WAAW,CAAC,gDAAgD,EAAE,MAAM,CAAC,OAAO,IAAI,eAAe;sBAClG;;;;;;IAGP;IAEA,IAAI,WAAW,aAAa,SAAS,MAAM,SAAS,SAAS;QAC3D,qBAAO,6LAAC;YAAI,WAAU;sBAA+D;;;;;;IACvF;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAG,WAAU;;4BAA4D;0CAC7D,6LAAC;gCAAK,WAAU;0CAAsD;;;;;;;;;;;;kCAEnF,6LAAC;wBACG,SAAS;wBACT,WAAU;kCACb;;;;;;;;;;;;0BAKH,6LAAC;gBAAK,WAAU;;kCACd,6LAAC;wBAAG,WAAU;kCAAyC;;;;;;oBAEtD,wBACC,6LAAC;wBAAE,WAAU;kCAAoB;;;;;6CAEjC,6LAAC;wBAAI,WAAU;kCACb,cAAA,6LAAC;4BAAI,WAAU;sCACb,cAAA,6LAAC;gCAAM,WAAU;;kDACf,6LAAC;wCAAM,WAAU;kDACf,cAAA,6LAAC;;8DACC,6LAAC;oDAAG,WAAU;8DAAY;;;;;;8DAC1B,6LAAC;oDAAG,WAAU;8DAAY;;;;;;8DAC1B,6LAAC;oDAAG,WAAU;8DAAY;;;;;;8DAC1B,6LAAC;oDAAG,WAAU;8DAAY;;;;;;8DAC1B,6LAAC;oDAAG,WAAU;8DAAY;;;;;;8DAC1B,6LAAC;oDAAG,WAAU;8DAAwB;;;;;;;;;;;;;;;;;kDAG1C,6LAAC;wCAAM,WAAU;kDACd,SAAS,GAAG,CAAC,CAAC,wBACb,6LAAC;gDAA4B,WAAU;;kEACrC,6LAAC;wDAAG,WAAU;;4DAAqC;4DAAE,QAAQ,UAAU;;;;;;;kEACvE,6LAAC;wDAAG,WAAU;;0EACZ,6LAAC;gEAAE,WAAU;0EAA4B,QAAQ,SAAS;;;;;;0EAC1D,6LAAC;gEAAE,WAAU;gEAAuC,OAAO,QAAQ,OAAO;0EACtE,QAAQ,OAAO;;;;;;;;;;;;kEAGrB,6LAAC;wDAAG,WAAU;kEACZ,cAAA,6LAAC;4DAAG,WAAU;sEACX,QAAQ,KAAK,CAAC,GAAG,CAAC,CAAC,MAAM,oBACxB,6LAAC;oEAAa,WAAU;;wEAAiB;wEACpC,KAAK,IAAI;wEAAC;sFAAC,6LAAC;4EAAK,WAAU;;gFAAY;gFAAE,KAAK,QAAQ;;;;;;;;mEADlD;;;;;;;;;;;;;;;kEAMf,6LAAC;wDAAG,WAAU;kEACZ,cAAA,6LAAC;4DAAI,WAAU;;8EACX,6LAAC;;wEAAK;wEAAM,QAAQ,WAAW;;;;;;;8EAC/B,6LAAC;oEAAK,WAAU;;wEAAe;wEAAM,QAAQ,WAAW;;;;;;;;;;;;;;;;;;kEAG9D,6LAAC;wDAAG,WAAU;kEACX,eAAe,QAAQ,MAAM;;;;;;kEAEhC,6LAAC;wDAAG,WAAU;kEACZ,cAAA,6LAAC;4DAAI,WAAU;;gEACZ,QAAQ,MAAM,KAAK,2BAClB;;sFACE,6LAAC;4EACC,SAAS,IAAM,mBAAmB,QAAQ,UAAU,EAAE;4EACtD,WAAU;sFACX;;;;;;sFAGD,6LAAC;4EACC,SAAS,IAAM,mBAAmB,QAAQ,UAAU,EAAE;4EACtD,WAAU;sFACX;;;;;;;;gEAMJ,QAAQ,MAAM,KAAK,4BAClB,6LAAC;oEACC,SAAS,IAAM,mBAAmB,QAAQ,UAAU,EAAE;oEACtD,WAAU;8EACX;;;;;;gEAKF,CAAC,QAAQ,MAAM,KAAK,cAAc,QAAQ,MAAM,KAAK,UAAU,mBAC9D,6LAAC;oEAAK,WAAU;8EAAyB;;;;;;;;;;;;;;;;;;+CAvDxC,QAAQ,UAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqE/C;GA/LwB;;QACY,+JAAU;QAC7B,kJAAS;;;KAFF"}},
    {"offset": {"line": 476, "column": 0}, "map": {"version":3,"sources":["file:///Users/thadzy/Documents/Thadzy/FIBO-Store/frontend/node_modules/next/navigation.js"],"sourcesContent":["module.exports = require('./dist/client/components/navigation')\n"],"names":[],"mappings":"AAAA,OAAO,OAAO","ignoreList":[0]}}]
}